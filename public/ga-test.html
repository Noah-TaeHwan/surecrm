<!doctype html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ğŸ§ª SureCRM GA í…ŒìŠ¤íŠ¸</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
      }
      .status {
        padding: 10px;
        margin: 10px 0;
        border-radius: 5px;
      }
      .success {
        background: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
      }
      .error {
        background: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
      }
      .info {
        background: #d1ecf1;
        color: #0c5460;
        border: 1px solid #bee5eb;
      }
      .code {
        background: #f8f9fa;
        padding: 10px;
        border-radius: 3px;
        font-family: monospace;
      }
    </style>
  </head>
  <body>
    <h1>ğŸ§ª SureCRM Google Analytics í…ŒìŠ¤íŠ¸</h1>

    <div id="env-status" class="status info">
      <h3>ğŸŒ í™˜ê²½ ì •ë³´</h3>
      <div class="code">
        <div>í˜¸ìŠ¤íŠ¸ëª…: <span id="hostname"></span></div>
        <div>í¬íŠ¸: <span id="port"></span></div>
        <div>ì „ì²´ URL: <span id="full-url"></span></div>
        <div>Vercel í™˜ê²½: <span id="is-vercel"></span></div>
        <div>ê°œë°œ í™˜ê²½: <span id="is-dev"></span></div>
      </div>
    </div>

    <div id="ga-status" class="status">
      <h3>ğŸ“Š Google Analytics ìƒíƒœ</h3>
      <div class="code">
        <div>GA ì¸¡ì • ID: <span id="ga-id"></span></div>
        <div>gtag í•¨ìˆ˜: <span id="gtag-loaded"></span></div>
        <div>dataLayer: <span id="datalayer-exists"></span></div>
        <div>ìˆ˜ì§‘ í—ˆìš©: <span id="should-collect"></span></div>
      </div>
    </div>

    <div id="test-actions" class="status info">
      <h3>ğŸ§ª í…ŒìŠ¤íŠ¸ ì•¡ì…˜</h3>
      <button onclick="testPageView()">í˜ì´ì§€ë·° í…ŒìŠ¤íŠ¸</button>
      <button onclick="testCustomEvent()">ì»¤ìŠ¤í…€ ì´ë²¤íŠ¸ í…ŒìŠ¤íŠ¸</button>
      <button onclick="checkNetworkRequests()">ë„¤íŠ¸ì›Œí¬ ìš”ì²­ í™•ì¸</button>
    </div>

    <div id="results" class="status">
      <h3>ğŸ“‹ í…ŒìŠ¤íŠ¸ ê²°ê³¼</h3>
      <div id="test-results" class="code"></div>
    </div>

    <!-- Google Analytics ìŠ¤í¬ë¦½íŠ¸ (í™˜ê²½ ì¡°ê±´ë¶€ ë¡œë“œ) -->
    <script>
      // ğŸ”§ í™˜ê²½ ê°ì§€
      const isLocalhost =
        window.location.hostname === 'localhost' ||
        window.location.hostname === '127.0.0.1' ||
        window.location.hostname.includes('.local');

      const isDevPort = [
        '5173',
        '5174',
        '5175',
        '5176',
        '5177',
        '5178',
        '5179',
        '5180',
        '5181',
        '5182',
        '5183',
        '5184',
        '5185',
        '5186',
        '5187',
        '3000',
        '8080',
      ].includes(window.location.port);

      const isProd =
        window.location.hostname.includes('.vercel.app') ||
        window.location.hostname.includes('surecrm.pro');

      const isDevelopment = !isProd && isLocalhost && isDevPort;

      // GA ì¸¡ì • ID (ì‹¤ì œ SureCRMê³¼ ë™ì¼)
      const GA_MEASUREMENT_ID = 'G-SZW1G856L5';

      // í”„ë¡œë•ì…˜ì—ì„œë§Œ GA ë¡œë“œ
      if (!isDevelopment && GA_MEASUREMENT_ID) {
        // Google Analytics ìŠ¤í¬ë¦½íŠ¸ ë™ì  ë¡œë“œ
        const script = document.createElement('script');
        script.async = true;
        script.src = `https://www.googletagmanager.com/gtag/js?id=${GA_MEASUREMENT_ID}`;
        document.head.appendChild(script);

        // GA ì´ˆê¸°í™”
        window.dataLayer = window.dataLayer || [];
        function gtag() {
          dataLayer.push(arguments);
        }
        window.gtag = gtag;
        gtag('js', new Date());
        gtag('config', GA_MEASUREMENT_ID, {
          send_page_view: true,
        });
      }

      // í˜ì´ì§€ ë¡œë“œ ì‹œ ìƒíƒœ ì—…ë°ì´íŠ¸
      document.addEventListener('DOMContentLoaded', function () {
        updateStatus();
      });

      function updateStatus() {
        // í™˜ê²½ ì •ë³´
        document.getElementById('hostname').textContent =
          window.location.hostname;
        document.getElementById('port').textContent =
          window.location.port || '443/80';
        document.getElementById('full-url').textContent = window.location.href;
        document.getElementById('is-vercel').textContent = isProd
          ? 'âœ… ì˜ˆ'
          : 'âŒ ì•„ë‹ˆì˜¤';
        document.getElementById('is-dev').textContent = isDevelopment
          ? 'âš ï¸ ê°œë°œí™˜ê²½'
          : 'ğŸš€ í”„ë¡œë•ì…˜';

        // GA ìƒíƒœ
        document.getElementById('ga-id').textContent =
          GA_MEASUREMENT_ID || 'âŒ ë¯¸ì„¤ì •';
        document.getElementById('gtag-loaded').textContent =
          typeof window.gtag === 'function' ? 'âœ… ë¡œë“œë¨' : 'âŒ ë¡œë“œ ì•ˆë¨';
        document.getElementById('datalayer-exists').textContent = Array.isArray(
          window.dataLayer
        )
          ? 'âœ… ì¡´ì¬í•¨'
          : 'âŒ ì—†ìŒ';
        document.getElementById('should-collect').textContent =
          !isDevelopment && GA_MEASUREMENT_ID ? 'âœ… í—ˆìš©' : 'âŒ ì°¨ë‹¨';

        // ìƒíƒœì— ë”°ë¥¸ ìŠ¤íƒ€ì¼ ì ìš©
        const gaStatusDiv = document.getElementById('ga-status');
        if (typeof window.gtag === 'function' && !isDevelopment) {
          gaStatusDiv.className = 'status success';
        } else {
          gaStatusDiv.className = 'status error';
        }
      }

      function testPageView() {
        const results = document.getElementById('test-results');

        if (typeof window.gtag === 'function') {
          window.gtag('event', 'page_view', {
            page_title: 'ğŸ§ª GA í…ŒìŠ¤íŠ¸ í˜ì´ì§€',
            page_location: window.location.href,
            event_category: 'test',
          });
          results.innerHTML += '<div>âœ… í˜ì´ì§€ë·° ì´ë²¤íŠ¸ ì „ì†¡ë¨</div>';
        } else {
          results.innerHTML +=
            '<div>âŒ gtag í•¨ìˆ˜ê°€ ì—†ì–´ì„œ í˜ì´ì§€ë·° ì „ì†¡ ì‹¤íŒ¨</div>';
        }
      }

      function testCustomEvent() {
        const results = document.getElementById('test-results');

        if (typeof window.gtag === 'function') {
          window.gtag('event', 'custom_test_event', {
            event_category: 'test',
            event_label: 'vercel_deployment_test',
            value: 1,
          });
          results.innerHTML += '<div>âœ… ì»¤ìŠ¤í…€ ì´ë²¤íŠ¸ ì „ì†¡ë¨</div>';
        } else {
          results.innerHTML +=
            '<div>âŒ gtag í•¨ìˆ˜ê°€ ì—†ì–´ì„œ ì»¤ìŠ¤í…€ ì´ë²¤íŠ¸ ì „ì†¡ ì‹¤íŒ¨</div>';
        }
      }

      function checkNetworkRequests() {
        const results = document.getElementById('test-results');
        results.innerHTML +=
          '<div>ğŸ” ë¸Œë¼ìš°ì € ê°œë°œìë„êµ¬ > ë„¤íŠ¸ì›Œí¬ íƒ­ì—ì„œ "google-analytics.com" ìš”ì²­ì„ í™•ì¸í•˜ì„¸ìš”</div>';
        results.innerHTML +=
          '<div>ğŸ“Š Google Analytics ì‹¤ì‹œê°„ ë³´ê³ ì„œì—ì„œ í˜„ì¬ í™œì„± ì‚¬ìš©ìë¥¼ í™•ì¸í•˜ì„¸ìš”</div>';
      }
    </script>
  </body>
</html>
